var Bambora=function(t){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(t){var n,r,i;i=function(){var t,e,n,r=Object.prototype.toString,i="undefined"!=typeof setImmediate?function(t){return setImmediate(t)}:setTimeout;try{Object.defineProperty({},"x",{}),t=function(t,e,n,r){return Object.defineProperty(t,e,{value:n,writable:!0,configurable:!1!==r})}}catch(e){t=function(t,e,n){return t[e]=n,t}}function o(t,r){n.add(t,r),e||(e=i(n.drain))}function a(t){var e,n=typeof t;return null==t||"object"!=n&&"function"!=n||(e=t.then),"function"==typeof e&&e}function s(){for(var t=0;t<this.chain.length;t++)c(this,1===this.state?this.chain[t].success:this.chain[t].failure,this.chain[t]);this.chain.length=0}function c(t,e,n){var r,i;try{!1===e?n.reject(t.msg):(r=!0===e?t.msg:e.call(void 0,t.msg))===n.promise?n.reject(TypeError("Promise-chain cycle")):(i=a(r))?i.call(r,n.resolve,n.reject):n.resolve(r)}catch(t){n.reject(t)}}function u(t){var e=this;e.triggered||(e.triggered=!0,e.def&&(e=e.def),e.msg=t,e.state=2,e.chain.length>0&&o(s,e))}function l(t,e,n,r){for(var i=0;i<e.length;i++)!function(i){t.resolve(e[i]).then(function(t){n(i,t)},r)}(i)}function f(t){this.def=t,this.triggered=!1}function h(t){if("function"!=typeof t)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var e=new function(t){this.promise=t,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}(this);this.then=function(t,n){var r={success:"function"!=typeof t||t,failure:"function"==typeof n&&n};return r.promise=new this.constructor(function(t,e){if("function"!=typeof t||"function"!=typeof e)throw TypeError("Not a function");r.resolve=t,r.reject=e}),e.chain.push(r),0!==e.state&&o(s,e),r.promise},this.catch=function(t){return this.then(void 0,t)};try{t.call(void 0,function(t){(function t(e){var n,r=this;if(!r.triggered){r.triggered=!0,r.def&&(r=r.def);try{(n=a(e))?o(function(){var i=new f(r);try{n.call(e,function(){t.apply(i,arguments)},function(){u.apply(i,arguments)})}catch(t){u.call(i,t)}}):(r.msg=e,r.state=1,r.chain.length>0&&o(s,r))}catch(t){u.call(new f(r),t)}}}).call(e,t)},function(t){u.call(e,t)})}catch(t){u.call(e,t)}}n=function(){var t,n,r;return{add:function(e,i){r=new function(t,e){this.fn=t,this.self=e,this.next=void 0}(e,i),n?n.next=r:t=r,n=r,r=void 0},drain:function(){var r=t;for(t=n=e=void 0;r;)r.fn.call(r.self),r=r.next}}}();var d=t({},"constructor",h,!1);return h.prototype=d,t(d,"__NPO__",0,!1),t(h,"resolve",function(t){return t&&"object"==typeof t&&1===t.__NPO__?t:new this(function(e,n){if("function"!=typeof e||"function"!=typeof n)throw TypeError("Not a function");e(t)})}),t(h,"reject",function(t){return new this(function(e,n){if("function"!=typeof e||"function"!=typeof n)throw TypeError("Not a function");n(t)})}),t(h,"all",function(t){var e=this;return"[object Array]"!=r.call(t)?e.reject(TypeError("Not an array")):0===t.length?e.resolve([]):new e(function(n,r){if("function"!=typeof n||"function"!=typeof r)throw TypeError("Not a function");var i=t.length,o=Array(i),a=0;l(e,t,function(t,e){o[t]=e,++a===i&&n(o)},r)})}),t(h,"race",function(t){var e=this;return"[object Array]"!=r.call(t)?e.reject(TypeError("Not an array")):new e(function(n,r){if("function"!=typeof n||"function"!=typeof r)throw TypeError("Not a function");l(e,t,function(t,e){n(e)},r)})}),h},(r=e)[n="Promise"]=r[n]||i(),t.exports&&(t.exports=r[n])})(n={exports:{}},n.exports);var n,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o,a=function(){return(a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((r=r.apply(t,e||[])).next())})}function c(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(o=t.UI||(t.UI={})).Fullscreen="fullscreen",o.Modal="modal",o.Inline="inline";var u,l={ui:t.UI.Fullscreen,language:"en-US",endpoint:"https://v1.checkout.bambora.com"},f=a({},l,{ui:t.UI.Fullscreen}),h=a({},l,{ui:t.UI.Modal}),d=a({},l,{ui:t.UI.Inline,container:null});!function(t){t.LoadSession="loadSession",t.InitiateHandshake="initiateHandshake",t.AcknowledgeCloseRequest="acknowledgeCloseRequest"}(u||(u={}));var p,y=u,v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},m=function(t){function e(n){var r=this.constructor,i=t.call(this,n)||this;return v(i,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,e),i}return i(e,t),e}(ReferenceError),_=function(t){function e(n){var r=this.constructor,i=t.call(this,n)||this;return v(i,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,e),i}return i(e,t),e}(Error),b=function(t){function e(n){var r=this.constructor,i=t.call(this,n)||this;return v(i,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,e),i}return i(e,t),e}(Error),g=function(t){function e(n){var r=this.constructor,i=t.call(this,n)||this;return v(i,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,e),i}return i(e,t),e}(Error),w=function(t){function e(n){var r=this.constructor,i=t.call(this,n)||this;return v(i,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,e),i}return i(e,t),e}(Error),E=Object.freeze({NoSessionTokenProvidedError:m,LoadSessionError:_,GenericMessageError:b,HandshakeError:g,ContainerNotSpecifiedError:w});!function(t){t.Authorize="authorize",t.Cancel="cancel",t.Close="close",t.PaymentTypeSelection="paymentTypeSelection",t.CardTypeResolve="cardTypeResolve"}(p||(p={}));var k=p,T=function(t){return t=t||Object.create(null),{on:function(e,n){(t[e]||(t[e]=[])).push(n)},off:function(e,n){t[e]&&t[e].splice(t[e].indexOf(n)>>>0,1)},emit:function(e,n){(t[e]||[]).slice().map(function(t){t(n)}),(t["*"]||[]).slice().map(function(t){t(e,n)})}}},I=function(){function t(t,e,n,r){this._origin=n,this._id="iframe_"+Math.random().toString(36).substring(2,15);var i=T(r);this.on=i.on.bind(this),this.off=i.off.bind(this),this._emit=i.emit.bind(this),this._iframeElement=this._createIFrameElementAsync(t,e)}return t.prototype.destroy=function(){var t=document.getElementById(this._id);window.removeEventListener("message",this._onMessageListener),delete this.on,delete this.off,delete this._emit,t&&t.parentElement.removeChild(t)},Object.defineProperty(t.prototype,"element",{get:function(){return this._iframeElement},enumerable:!0,configurable:!0}),t.prototype.postMessage=function(t,e){return s(this,void 0,void 0,function(){var n,r,i,o,s;return c(this,function(c){switch(c.label){case 0:return(r=e)?[3,2]:[4,this.element];case 1:r=c.sent(),c.label=2;case 2:return n=r,i=this._origin,o="message_"+Math.random().toString(36).substring(2,15),s=new Promise(function(t,e){window.addEventListener("message",function n(r){if(r.origin!==i)return;if(!r.data||r.data.messageId!==o)return;window.removeEventListener("message",n);var a=r.data.payload;r.data.result||e(new b(a));t(a)},!1)}),n.contentWindow.postMessage(a({},t,{messageId:o}),this._origin),[2,s]}})})},t.prototype._createIFrameElementAsync=function(t,e){return s(this,void 0,void 0,function(){var n,r=this;return c(this,function(i){switch(i.label){case 0:return[4,new Promise(function(n,i){var o=r._createIframeElement();o.onload=function(){return n(o)},o.onerror=function(){return i(o)},o.setAttribute("src",t),e.appendChild(o)})];case 1:return n=i.sent(),this._rebindIframeEventHandlers(n),this._initiateEventProxy(),[4,this._initiateHandshake(n)];case 2:return i.sent(),[2,n]}})})},t.prototype._createIframeElement=function(){var t=document.createElement("iframe");return t.setAttribute("id",this._id),t.setAttribute("name",this._id),t.setAttribute("frameborder","0"),t.setAttribute("allowTransparency","true"),t.setAttribute("style","width:100%; height:100%;"),t},t.prototype._initiateHandshake=function(t){return s(this,void 0,void 0,function(){var e;return c(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.postMessage({action:y.InitiateHandshake,payload:this._id},t)];case 1:return n.sent(),[3,3];case 2:throw e=n.sent(),new g(e.message);case 3:return[2]}})})},t.prototype._initiateEventProxy=function(){this._onMessageListener=this._onMessage.bind(this),window.addEventListener("message",this._onMessageListener,!1)},t.prototype._onMessage=function(t){t.origin===this._origin&&t.data&&t.data.handshakeId===this._id&&this._emit(t.data.event,t.data.payload)},t.prototype._rebindIframeEventHandlers=function(t){var e=this;return t.onload=function(){return e._initiateHandshake(t)},t.onerror=null,t},t}();var C,A=function(){function t(t,e){this.sessionToken=t,this._options=a({},l,e)}return t.prototype.initialize=function(t){return s(this,void 0,void 0,function(){return c(this,function(e){if(t&&(this.sessionToken=t),!this.sessionToken)throw new m("A session invocation was attempted while no session token was provided.");return[2,this.sessionToken]})})},Object.defineProperty(t.prototype,"_checkoutUrl",{get:function(){var t,e,n,r,i,o=(t=this._options,e=t.styles,n=t.labels,r=t.demo,i="3.0.6",window&&"string"==typeof window["__bambora-system"]&&(i+="-"+window["__bambora-system"]),{styles:e,labels:n,demo:r,version:i}),a=function(t){return{ui:t.ui,language:t.language}}(this._options),s=function(t){var e=JSON.stringify(t);return"{}"===e?"":btoa(e)}(o);s&&(s="#"+s);var c="?"+function(t){return Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}(a);return this.sessionToken?this._options.endpoint+"/"+this.sessionToken+c+s:""+this._options.endpoint+c+s},enumerable:!0,configurable:!0}),t}(),O=function(t){function e(e,n){void 0===n&&(n={});var r=t.call(this,e,n)||this;r._container=null;var i=T(r._options.eventHandlerMap);return r.on=i.on.bind(r),r.off=i.off.bind(r),r._emit=i.emit.bind(r),r}return i(e,t),e.prototype.destroy=function(){this._asyncIframe.destroy(),delete this.on,delete this.off,delete this._emit},e.prototype.initialize=function(e){return s(this,void 0,void 0,function(){var n;return c(this,function(r){switch(r.label){case 0:return n=this._loadSession,[4,t.prototype.initialize.call(this,e)];case 1:return[2,n.apply(this,[r.sent()])]}})})},Object.defineProperty(e.prototype,"iframe",{get:function(){return this._asyncIframe.element},enumerable:!0,configurable:!0}),e.prototype._createAsyncIframe=function(){var t=this;if(!this.__asyncIframe){if(null===this._container)throw new w("A container must be specified before accessing the iframe.");var e=this._checkoutUrl,n=function(t){t=0===t.indexOf("blob:")?t.slice(5):t;var e=document.createElement("a");return e.setAttribute("href",t),e.protocol+"//"+e.hostname+("80"!==e.port&&"443"!==e.port&&"0"!==e.port&&e.port?":"+e.port:"")}(e);this.__asyncIframe=new I(e,this._container,n,{"*":[function(e,n){return t._emit(e,n)}]})}},e.prototype._loadSession=function(t){return s(this,void 0,void 0,function(){var e,n;return c(this,function(r){switch(r.label){case 0:if(this._lastSessionToken){if(t===this._lastSessionToken)return[2,Promise.resolve(t)];throw new _("Loading a different session is not supported. Try creating a new Checkout instance.")}r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._asyncIframe.postMessage({action:y.LoadSession,payload:t})];case 2:return e=r.sent(),this._lastSessionToken=t,[2,e];case 3:throw n=r.sent(),new _(n.message);case 4:return[2]}})})},Object.defineProperty(e.prototype,"_asyncIframe",{get:function(){return this._createAsyncIframe(),this.__asyncIframe},enumerable:!0,configurable:!0}),e}(A),S=function(t){function e(e,n){void 0===n&&(n=a({},d));var r=t.call(this,e,a({},d,n))||this;return null===r._options.container?r:(r._container=r._options.container,r._createAsyncIframe(),r)}return i(e,t),e.prototype.mount=function(t){return s(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return this._container=t,[4,this.iframe];case 1:return[2,e.sent()]}})})},e}(O),x=function(t){function e(e,n){void 0===n&&(n=a({},f));var r=t.call(this,e,a({},f,n))||this;return r.sessionToken?(r._redirect(r._checkoutUrl),r):r}return i(e,t),e.prototype.initialize=function(e){return s(this,void 0,void 0,function(){return c(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[2,this._checkoutUrl]}})})},e.prototype._redirect=function(t){window.location.assign(t)},e}(A),N=function(t){function e(e,n){void 0===n&&(n=a({},h));var r=t.call(this,e,a({},h,n))||this;return r._isActive=!1,r._initiatingElement=null,r._enableBodyScroll=null,L(r._options.cspNonce),r._id=Math.random().toString(36).substring(2,15),r._overlayContainer=r._createOverlayContainer(),r._backdrop=r._createBackdrop(),r._container=r._createIframeContainer(),document.body.appendChild(r._overlayContainer),r._overlayContainer.appendChild(r._backdrop),r._overlayContainer.appendChild(r._createFocusTrap()),r._overlayContainer.appendChild(r._container),r._overlayContainer.appendChild(r._createFocusTrap()),r._createAsyncIframe(),r.on(k.Cancel,r.hide.bind(r)),r.on(k.Close,r.hide.bind(r)),r}return i(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this._overlayContainer.parentElement.removeChild(this._overlayContainer),this._enableBodyScroll&&this._enableBodyScroll()},e.prototype.show=function(t){return s(this,void 0,void 0,function(){var n,r,i;return c(this,function(o){switch(o.label){case 0:return this._isActive?[2]:(this._isActive=!0,[4,this.iframe]);case 1:return o.sent(),this._initiatingElement=t&&t.target||null,n=this._getElementCoordinates(),r=this._getViewportDifference(n),(i=this._container).style.transform="translateX("+r.x+"px) translateY("+r.y+"px)",i.style["-webkit-transform"]=i.style.transform,this._overlayContainer.classList.add(C.Enter),this._overlayContainer.style.display="block",[4,j(0)];case 2:return o.sent(),i.style.transform="translateX(0) translateY(0)",i.style["-webkit-transform"]=i.style.transform,this._overlayContainer.classList.add(C.EnterActive),this._enableBodyScroll=function(){var t=document.documentElement,e=document.body,n=t.style.cssText||"",r=e.style.cssText||"",i=window.pageYOffset||t.scrollTop||e.scrollTop||0,o=e.clientWidth,a=window.innerWidth>document.documentElement.clientWidth||document.documentElement.scrollHeight>document.documentElement.clientHeight;a&&(e.style.position="fixed",e.style.width="100%",e.style.top=-i+"px");e.clientWidth<o&&(e.style.overflow="hidden");a&&(t.style.overflowY="scroll");return function(){e.style.cssText=r,t.style.cssText=n,e.scrollTop=i,t.scrollTop=i}}(),[4,j(e.ANIMATION_DURATION)];case 3:return o.sent(),i.focus(),this._overlayContainer.classList.remove(C.Enter,C.EnterActive),[2]}})})},e.prototype.hide=function(t){return s(this,void 0,void 0,function(){var n,r,i,o;return c(this,function(a){switch(a.label){case 0:return this._isActive?(this._isActive=!1,n=this._getElementCoordinates(t),r=this._getViewportDifference(n),i=this._container,this._enableBodyScroll&&(this._enableBodyScroll(),this._enableBodyScroll=null),i.style.transform="translateX(0) translateY(0)",i.style["-webkit-transform"]=i.style.transform,this._overlayContainer.classList.add(C.Leave),[4,j(0)]):[2];case 1:return a.sent(),i.style.transform="translateX("+r.x+"px) translateY("+r.y+"px)",i.style["-webkit-transform"]=i.style.transform,this._overlayContainer.classList.add(C.LeaveActive),[4,j(e.ANIMATION_DURATION)];case 2:return a.sent(),(o=this._initiatingElement)&&o.focus&&o.focus(),this._initiatingElement=null,this._overlayContainer.style.display="none",this._overlayContainer.classList.remove(C.Leave,C.LeaveActive),[2]}})})},Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isActive},enumerable:!0,configurable:!0}),e.prototype._getElementCoordinates=function(t){var e=t&&t.getBoundingClientRect?t:this._initiatingElement;if(!e)return{x:0,y:0};var n=e.getBoundingClientRect();return{x:n.left+n.width/2,y:n.top+n.height/2}},e.prototype._getViewportDifference=function(t){return t.x?{x:(t.x||0)-window.innerWidth/2,y:(t.y||0)-window.innerHeight/2}:{x:0,y:0}},e.prototype._createOverlayContainer=function(){var t=document.createElement("div");return t.setAttribute("id","bc-overlay-container-"+this._id),t.setAttribute("aria-label","Bambora Checkout"),t.setAttribute("role","dialog"),t.style.display="none",t.classList.add(C.OverlayContainer),t},e.prototype._createIframeContainer=function(){var t=document.createElement("div");return t.setAttribute("id","bc-iframe-container-"+this._id),t.classList.add(C.IframeContainer),t.tabIndex=0,t},e.prototype._createBackdrop=function(){var t=document.createElement("div");return t.setAttribute("id","bc-backdrop-"+this._id),t.classList.add(C.Backdrop),t},e.prototype._createFocusTrap=function(){var t=this,e=document.createElement("div");return e.tabIndex=0,e.addEventListener("focus",function(){return t._container.focus()}),e},e.ANIMATION_DURATION=500,e.DEFAULT_TRANSITION="all "+e.ANIMATION_DURATION+"ms cubic-bezier(0.25, 0.8, 0.25, 1)",e}(O);function L(t){if(!document.querySelector("style[bc-style]")){var e=document.createElement("style");t&&e.setAttribute("nonce",t),e.setAttribute("bc-style",""),e.appendChild(document.createTextNode("")),document.head.insertBefore(e,document.head.firstChild);var n=function(t){return function(e,n){return function(t,e,n){t.insertRule(e+" { "+n.join("; ")+" }",0)}(t,e,n)}}(e.sheet);n("."+C.IframeContainer+", ."+C.OverlayContainer+", ."+C.Backdrop,["width: 100vw","height: 100vh"]),n("."+C.OverlayContainer,["z-index: 999999","position: fixed"]),n("."+C.OverlayContainer+", ."+C.Backdrop,["top: 0","left: 0"]),n("."+C.Backdrop,["background: rgba(0, 0, 0, 0.5)","position: absolute"]),n("."+C.IframeContainer,["position: relative"]);var r="."+C.OverlayContainer+"."+C.Enter,i="."+C.OverlayContainer+"."+C.Leave,o=r+"."+C.EnterActive,a=i+"."+C.LeaveActive;n(r+", "+i+", "+r+" ."+C.Backdrop+", "+i+" ."+C.Backdrop+", "+r+" ."+C.IframeContainer+", "+i+" ."+C.IframeContainer+", "+r+" iframe, "+i+" iframe",["transition: "+N.DEFAULT_TRANSITION,"-webkit-transition: "+N.DEFAULT_TRANSITION]),n(r+" iframe, "+a+" iframe",["opacity: 0","transform: scale(0.1)"]),n(r+" ."+C.Backdrop+", "+a+" ."+C.Backdrop,["opacity: 0"]),n(o+" ."+C.Backdrop+", "+o+" iframe, "+i+" ."+C.Backdrop+", "+i+" iframe",["opacity: 1"]),n(o+" iframe, "+i+" iframe",["transform: scale(1)","-webkit-transform: scale(1)"])}}function j(t){return s(this,void 0,void 0,function(){return c(this,function(e){return[2,new Promise(function(e){return setTimeout(e,t)})]})})}return function(t){t.Backdrop="bc-backdrop",t.IframeContainer="bc-iframe-container",t.OverlayContainer="bc-overlay-container",t.Leave="bc-leave",t.LeaveActive="bc-leave-active",t.Enter="bc-enter",t.EnterActive="bc-enter-active"}(C||(C={})),t.InlineCheckout=S,t.RedirectCheckout=x,t.ModalCheckout=N,t.Errors=E,t.Event=k,t}({});
